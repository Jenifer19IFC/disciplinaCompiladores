<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <h1><title>Compiladores</title></h1>
</head>
    <body>
        <form action= "" method="POST">
            <fieldset>
            <?php
                print("<h4>ANALISADOR LÉXICO</h4>
                Escreva a sentença abaixo:<br><br>");
            ?>
                <label for ="entrada"></label>
                    <textarea name="entrada" id="entrada"></textarea><br>
                    <input type="submit" value="Enviar">  

        <?php

            $entrada = isset($_POST['entrada']) ? $_POST['entrada'] : "";

            $delta = array('0' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'4','g'=>'1','h'=>'1','i'=>'2','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'7','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'12','1'=>'12','2'=>'12','3'=>'12','4'=>'12','5'=>'12','6'=>'12','7'=>'12','8'=>'12','9'=>'12','>'=>'13','<'=>'14','('=>'15',')'=>'16','{'=>'17','}'=>'18','-'=>'19','+'=>'20','*'=>'21','/'=>'22','='=>'23',"!"=>'25',' ' => '26', "\n" => '28'),
            '1' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '2' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'3','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '3' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '4' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'5','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '5' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'6','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '6' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '7' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'8','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '8' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'9','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '9' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'10','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '10' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'11','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '11' =>array('a'=> "1",'b'=>'1','c'=>'1','d'=>'1','e'=>'1','f'=>'1','g'=>'1','h'=>'1','i'=>'1','j'=>'1','k'=>'1','l'=>'1','m'=>'1','n'=>'1','o'=>'1','p'=>'1','q'=>'1','r'=>'1','s'=>'1','t'=>'1','u'=>'1','v'=>'1','w'=>'1','x'=>'1','y'=>'1','z'=>'1','0'=>'1','1'=>'1','2'=>'1','3'=>'1','4'=>'1','5'=>'1','6'=>'1','7'=>'1','8'=>'1','9'=>'1'),
            '12' =>array('0'=>'12','1'=>'12','2'=>'12','3'=>'12','4'=>'12','5'=>'12','6'=>'12','7'=>'12','8'=>'12','9'=>'12'),
            '13' =>array(),
            '14' =>array(),
            '15' =>array(),
            '16' =>array(),
            '17' =>array(),
            '18' =>array(),
            '19' =>array(),
            '20' =>array(),
            '21' =>array(),
            '22' =>array(),
            '23' =>array('='=>'24'),
            '24' =>array(),
            '25' =>array('='=>'27'),
            '26' =>array(),
            '27' =>array(),
            '28' =>array(),
            );

            //$entrada = str_replace('\n', '<br>', $entrada);
            // echo " teste" . strpos($entrada, "\n");

            $finais = array('1'=> 'VARIÁVEL', '2'=>'VARIÁVEL', '3' =>'IF', '4' => 'VARIÁVEL', '5' =>'VARIÁVEL','6'=> 'FOR', '7'=> 'VARIÁVEL', '8'=>'VARIÁVEL',  '9'=> 'VARIÁVEL', '10' => 'VARIÁVEL','11'=> 'PRINT', '12'=>'CONSTANTE', '13'=> 'MAIOR', '14'=>'MENOR', '15' => 'AP', '16' => 'FP', '17' =>'AC','18'=> 'FC', '19'=> 'MENOS', '20'=>'MAIS',  '21'=> 'MULTIPLICAÇÃO', '22' => 'BARRA','23'=> 'IGUAL', '24'=>'IGUALIGUAL','26'=>'ESPAÇO','27'=>'DIFERENTE', '28' => 'Quebra de linha');
            
            $estado = 0;
            $lexema = '';
            $lista_tokens = array(); 
            $posicao = 1;
            $linha = 1;
  
            for($i = 0; $i<strlen($entrada);$i++){
                try{
                    if(array_key_exists($estado, $delta) && array_key_exists($entrada[$i], $delta[$estado])){
                        $estado = $delta[$estado][$entrada[$i]];
                        $lexema = $lexema.$entrada[$i];
                        if($entrada[$i] == "\n"){
                            $linha = $linha + 1;
                        }

                   }else{
                        throw new Exception("<br><br>Há um erro léxico!");
                   }
                   
                }catch(Exception $e){
                    if(array_key_exists($estado, $finais)){
                        array_push($lista_tokens,  '<b>Lexema:</b> '.$lexema.' --> <b>Token:</b> '.$finais[$estado].' --> <b>Posição:</b> '.$posicao. ' --> <b>Linha:</b> '.$linha);
                        $posicao = $posicao + 1;
                        $estado = 0;
                        $lexema = '';
                        $i = $i-1;
                    }
                    else{   
                        if($i+1 <strlen($entrada) && $entrada[$i+1] == "\n"){
                            continue;   
                        }
                        print("<br><br>TOKENS RECONHECIDOS ANTES DO ERRO:\n");
                        foreach($lista_tokens as $valor){
                            echo '<br>'.$valor;
                        }
                        echo $e->getMessage();
                        echo '<br>Linha:</b> '.$linha;
                        //echo "<br>Posição: ".$posicao;
                    }
                }  
            }
            if(array_key_exists($estado, $finais)){
                array_push($lista_tokens, '<b>Lexema:</b> '.$lexema.'  --> <b>Token:</b> '.$finais[$estado].' --> <b>Posição:</b> '.$posicao. ' --> <b>Linha:</b> '.$linha);
            }
            print_r("<br><br><h4>Lista de tokens reconhecidos: </h4>");
            foreach($lista_tokens as $valor){
                echo '<br>'.$valor;
            }
            

            //phpinfo();.. 
                
        ?>

            </body>
        </fieldset>
    </form>
</html>